<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Input Manager Demo - Three.js Factories</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        background: linear-gradient(
          135deg,
          #1a1a2e 0%,
          #16213e 50%,
          #0f3460 100%
        );
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        color: white;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
      }

      .header h1 {
        font-size: 2.5rem;
        margin: 0;
        background: linear-gradient(135deg, #4fc3f7, #29b6f6, #0288d1);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .header p {
        font-size: 1.1rem;
        color: #b0b0b0;
        margin: 10px 0 20px 0;
      }

      .demo-container {
        display: flex;
        gap: 30px;
        align-items: flex-start;
        max-width: 1200px;
        width: 100%;
        padding: 0 20px;
      }

      .demo-canvas-section {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .demo-info-section {
        width: 350px;
        background: rgba(0, 0, 0, 0.8);
        border-radius: 12px;
        padding: 25px;
        border: 1px solid rgba(79, 195, 247, 0.3);
        backdrop-filter: blur(10px);
      }

      .demo-info-section h2 {
        color: #4fc3f7;
        margin: 0 0 20px 0;
        font-size: 1.5rem;
        text-align: center;
      }

      .info-panel {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .info-panel h3 {
        color: #4fc3f7;
        margin: 0 0 10px 0;
        font-size: 1.1rem;
      }

      .info-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        padding: 5px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .info-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
      }

      .info-label {
        color: #e0e0e0;
        font-size: 0.9rem;
      }

      .info-value {
        color: #4fc3f7;
        font-weight: 600;
        font-family: "Courier New", monospace;
      }

      .controls-section {
        text-align: center;
        margin-top: 20px;
      }

      .controls-section h3 {
        color: #4fc3f7;
        margin-bottom: 15px;
      }

      .control-buttons {
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
      }

      .demo-button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: white;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 500;
        transition: all 0.2s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .demo-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      .demo-button:active {
        transform: translateY(0);
      }

      .demo-button.stop-btn {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
      }

      .demo-button.stop-btn:hover {
        box-shadow: 0 4px 12px rgba(255, 107, 107, 0.4);
      }

      .instructions {
        background: rgba(255, 193, 7, 0.1);
        border: 1px solid rgba(255, 193, 7, 0.3);
        border-radius: 8px;
        padding: 15px;
        margin-top: 20px;
      }

      .instructions h4 {
        color: #ffc107;
        margin: 0 0 10px 0;
        font-size: 1rem;
      }

      .instructions ul {
        margin: 0;
        padding-left: 20px;
        color: #e0e0e0;
      }

      .instructions li {
        margin-bottom: 5px;
        font-size: 0.9rem;
      }

      .navigation {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1000;
      }

      .nav-button {
        background: rgba(0, 0, 0, 0.8);
        border: 1px solid rgba(79, 195, 247, 0.3);
        color: #4fc3f7;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        text-decoration: none;
        transition: all 0.2s ease;
        display: inline-block;
      }

      .nav-button:hover {
        background: #4fc3f7;
        color: #000;
      }

      @media (max-width: 768px) {
        .demo-container {
          flex-direction: column;
          align-items: center;
        }

        .demo-info-section {
          width: 100%;
          max-width: 400px;
        }

        .header h1 {
          font-size: 2rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="navigation">
      <a href="/" class="nav-button">‚Üê Back to Main Demo</a>
    </div>

    <div class="header">
      <h1>üéÆ InputManager Demo</h1>
      <p>Real-time input state monitoring and game controls showcase</p>
    </div>

    <div class="demo-container">
      <div class="demo-canvas-section">
        <!-- Canvas will be inserted here by the demo script -->
      </div>

      <div class="demo-info-section">
        <h2>Input State Monitor</h2>

        <div class="info-panel">
          <h3>üéπ Keyboard</h3>
          <div class="info-item">
            <span class="info-label">Keys Pressed:</span>
            <span class="info-value" id="keyboard-keys">None</span>
          </div>
          <div class="info-item">
            <span class="info-label">Modifiers:</span>
            <span class="info-value" id="keyboard-modifiers">None</span>
          </div>
        </div>

        <div class="info-panel">
          <h3>üñ±Ô∏è Mouse</h3>
          <div class="info-item">
            <span class="info-label">Position:</span>
            <span class="info-value" id="mouse-position">(0, 0)</span>
          </div>
          <div class="info-item">
            <span class="info-label">Buttons:</span>
            <span class="info-value" id="mouse-buttons">None</span>
          </div>
          <div class="info-item">
            <span class="info-label">Over Canvas:</span>
            <span class="info-value" id="mouse-over">No</span>
          </div>
        </div>

        <div class="info-panel">
          <h3>üéÆ Game State</h3>
          <div class="info-item">
            <span class="info-label">Movement:</span>
            <span class="info-value" id="movement-vector">(0, 0)</span>
          </div>
          <div class="info-item">
            <span class="info-label">Player State:</span>
            <span class="info-value" id="player-state">Normal</span>
          </div>
        </div>

        <div class="controls-section">
          <h3>Demo Controls</h3>
          <div class="control-buttons">
            <button class="demo-button" id="start-demo">Start Demo</button>
            <button class="demo-button stop-btn" id="stop-demo">
              Stop Demo
            </button>
          </div>
        </div>

        <div class="instructions">
          <h4>üí° Try These Controls:</h4>
          <ul>
            <li><strong>WASD</strong> - Move player around</li>
            <li><strong>Shift</strong> - Run (hold while moving)</li>
            <li><strong>Ctrl</strong> - Crouch (hold while moving)</li>
            <li><strong>Space</strong> - Jump action</li>
            <li><strong>E</strong> - Interact action</li>
            <li><strong>Mouse</strong> - Click and move around canvas</li>
            <li><strong>Wheel</strong> - Scroll to test wheel events</li>
            <li><strong>R</strong> - Reset player position</li>
            <li><strong>H</strong> - Show help in console</li>
            <li><strong>Esc</strong> - Stop demo</li>
          </ul>
        </div>
      </div>
    </div>

    <script type="module">
      import { InputManager, KeyCode, MouseButton } from "/src/factories.js";

      class SimpleInputDemo {
        constructor() {
          this.inputManager = null;
          this.demoRunning = false;
          this.animationId = null;
          this.canvas = null;
          this.ctx = null;

          this.setupEventListeners();
        }

        setupEventListeners() {
          document
            .getElementById("start-demo")
            .addEventListener("click", () => this.startDemo());
          document
            .getElementById("stop-demo")
            .addEventListener("click", () => this.stopDemo());
        }

        startDemo() {
          if (this.demoRunning) return;

          this.createCanvas();
          this.inputManager = InputManager.getInstance({
            target: this.canvas,
            preventDefault: true,
          });
          this.inputManager.setCanvas(this.canvas);
          this.inputManager.connect();

          this.demoRunning = true;
          this.startUpdateLoop();

          console.log("Simple input demo started!");
          console.log("Try pressing keys, moving mouse, and clicking!");
        }

        stopDemo() {
          if (!this.demoRunning) return;

          if (this.inputManager) {
            this.inputManager.disconnect();
            this.inputManager = null;
          }

          if (this.animationId) {
            cancelAnimationFrame(this.animationId);
            this.animationId = null;
          }

          if (this.canvas) {
            this.canvas.remove();
            this.canvas = null;
            this.ctx = null;
          }

          this.demoRunning = false;
          this.resetUI();

          console.log("Input demo stopped!");
        }

        createCanvas() {
          this.canvas = document.createElement("canvas");
          this.canvas.width = 600;
          this.canvas.height = 400;
          this.canvas.style.border = "2px solid #4fc3f7";
          this.canvas.style.borderRadius = "8px";
          this.canvas.style.background =
            "linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)";

          document
            .querySelector(".demo-canvas-section")
            .appendChild(this.canvas);

          this.ctx = this.canvas.getContext("2d");
        }

        startUpdateLoop() {
          const update = () => {
            if (!this.demoRunning) return;

            this.updateUI();
            this.renderCanvas();
            this.animationId = requestAnimationFrame(update);
          };
          update();
        }

        renderCanvas() {
          if (!this.ctx || !this.inputManager) return;

          // Clear canvas
          this.ctx.fillStyle = "#1a1a2e";
          this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

          // Draw grid
          this.ctx.strokeStyle = "#333";
          this.ctx.lineWidth = 1;
          for (let x = 0; x <= this.canvas.width; x += 50) {
            this.ctx.beginPath();
            this.ctx.moveTo(x, 0);
            this.ctx.lineTo(x, this.canvas.height);
            this.ctx.stroke();
          }
          for (let y = 0; y <= this.canvas.height; y += 50) {
            this.ctx.beginPath();
            this.ctx.moveTo(0, y);
            this.ctx.lineTo(this.canvas.width, y);
            this.ctx.stroke();
          }

          // Draw mouse cursor
          const mousePos = this.inputManager.getMousePosition();
          if (this.inputManager.isMouseOverCanvas()) {
            this.ctx.strokeStyle = "#4fc3f7";
            this.ctx.lineWidth = 2;
            this.ctx.beginPath();
            this.ctx.arc(
              mousePos.canvas.x,
              mousePos.canvas.y,
              10,
              0,
              Math.PI * 2
            );
            this.ctx.stroke();

            // Draw crosshair
            this.ctx.beginPath();
            this.ctx.moveTo(mousePos.canvas.x - 15, mousePos.canvas.y);
            this.ctx.lineTo(mousePos.canvas.x + 15, mousePos.canvas.y);
            this.ctx.moveTo(mousePos.canvas.x, mousePos.canvas.y - 15);
            this.ctx.lineTo(mousePos.canvas.x, mousePos.canvas.y + 15);
            this.ctx.stroke();
          }

          // Draw movement indicator
          const movement = this.inputManager.getMovementVector();
          if (movement.x !== 0 || movement.y !== 0) {
            const centerX = this.canvas.width / 2;
            const centerY = this.canvas.height / 2;

            this.ctx.strokeStyle = "#ff6b95";
            this.ctx.lineWidth = 4;
            this.ctx.beginPath();
            this.ctx.moveTo(centerX, centerY);
            this.ctx.lineTo(
              centerX + movement.x * 50,
              centerY - movement.y * 50
            );
            this.ctx.stroke();

            // Arrow head
            const angle = Math.atan2(-movement.y, movement.x);
            const headX = centerX + movement.x * 50;
            const headY = centerY - movement.y * 50;

            this.ctx.beginPath();
            this.ctx.moveTo(headX, headY);
            this.ctx.lineTo(
              headX - 10 * Math.cos(angle - Math.PI / 6),
              headY - 10 * Math.sin(angle - Math.PI / 6)
            );
            this.ctx.moveTo(headX, headY);
            this.ctx.lineTo(
              headX - 10 * Math.cos(angle + Math.PI / 6),
              headY - 10 * Math.sin(angle + Math.PI / 6)
            );
            this.ctx.stroke();
          }

          // Draw instructions
          this.ctx.fillStyle = "#4fc3f7";
          this.ctx.font = "14px monospace";
          this.ctx.fillText(
            "Interactive Canvas - Move mouse, press WASD keys",
            10,
            25
          );
        }

        updateUI() {
          if (!this.inputManager) return;

          // Update keyboard info
          const keyboardState = this.inputManager.getKeyboardState();
          const pressedKeys = [];
          for (const [key, pressed] of keyboardState.keys) {
            if (pressed) {
              pressedKeys.push(this.keyCodeToReadable(key));
            }
          }
          document.getElementById("keyboard-keys").textContent =
            pressedKeys.length > 0 ? pressedKeys.join(", ") : "None";

          // Update modifiers
          const modifiers = [];
          if (keyboardState.modifiers.shift) modifiers.push("Shift");
          if (keyboardState.modifiers.ctrl) modifiers.push("Ctrl");
          if (keyboardState.modifiers.alt) modifiers.push("Alt");
          if (keyboardState.modifiers.meta) modifiers.push("Meta");
          document.getElementById("keyboard-modifiers").textContent =
            modifiers.length > 0 ? modifiers.join(", ") : "None";

          // Update mouse info
          const mousePos = this.inputManager.getNormalizedMousePosition();
          document.getElementById(
            "mouse-position"
          ).textContent = `(${mousePos.x.toFixed(2)}, ${mousePos.y.toFixed(
            2
          )})`;

          const mouseState = this.inputManager.getMouseState();
          const pressedButtons = [];
          for (const [button, pressed] of mouseState.buttons) {
            if (pressed) {
              pressedButtons.push(this.mouseButtonToReadable(button));
            }
          }
          document.getElementById("mouse-buttons").textContent =
            pressedButtons.length > 0 ? pressedButtons.join(", ") : "None";

          document.getElementById("mouse-over").textContent =
            this.inputManager.isMouseOverCanvas() ? "Yes" : "No";

          // Update movement vector
          const movement = this.inputManager.getMovementVector();
          document.getElementById(
            "movement-vector"
          ).textContent = `(${movement.x.toFixed(2)}, ${movement.y.toFixed(
            2
          )})`;

          // Update player state
          const states = [];
          if (this.inputManager.isKeyDown("ShiftLeft")) states.push("Running");
          if (this.inputManager.isKeyDown("ControlLeft"))
            states.push("Crouching");
          if (this.inputManager.isKeyDown("Space")) states.push("Jumping");
          document.getElementById("player-state").textContent =
            states.length > 0 ? states.join(", ") : "Normal";
        }

        keyCodeToReadable(keyCode) {
          const keyMap = {
            KeyW: "W",
            KeyA: "A",
            KeyS: "S",
            KeyD: "D",
            KeyE: "E",
            KeyR: "R",
            KeyH: "H",
            Space: "Space",
            Enter: "Enter",
            Escape: "Esc",
            ShiftLeft: "L-Shift",
            ControlLeft: "L-Ctrl",
            ArrowUp: "‚Üë",
            ArrowDown: "‚Üì",
            ArrowLeft: "‚Üê",
            ArrowRight: "‚Üí",
          };
          return keyMap[keyCode] || keyCode;
        }

        mouseButtonToReadable(button) {
          const buttonMap = { 0: "Left", 1: "Middle", 2: "Right" };
          return buttonMap[button] || `Button ${button}`;
        }

        resetUI() {
          document.getElementById("keyboard-keys").textContent = "None";
          document.getElementById("keyboard-modifiers").textContent = "None";
          document.getElementById("mouse-position").textContent = "(0, 0)";
          document.getElementById("mouse-buttons").textContent = "None";
          document.getElementById("mouse-over").textContent = "No";
          document.getElementById("movement-vector").textContent = "(0, 0)";
          document.getElementById("player-state").textContent = "Normal";
        }
      }

      // Initialize the demo UI
      const demo = new SimpleInputDemo();

      // Auto-cleanup on page unload
      window.addEventListener("beforeunload", () => {
        demo.stopDemo();
      });
    </script>
  </body>
</html>
